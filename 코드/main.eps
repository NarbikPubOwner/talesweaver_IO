import BGMPlayer as BGM;

import Utility;

import GameInformation as GI;
import PlayerInformation as PI;
import GlobalConstant as GC;

import BasicSetting;
import OpeningDirecting;
import GameModeSelect;
import GameDifficultySelect;
import MainGame;
import UnitSkillSystem;
import MouseSystem;



function onPluginStart() {//맵 실행시 한번만 실행
	BGM.loadSound();
    SetMemory(0x5124F0, SetTo, 21);// 기본 배속, 약 48프레임당 1초
	MouseSystem.variableInit();

	PI.Init();
}

function beforeTriggerExec() {//클래식 트리거 작동 전 실행(맵에 기본적으로 들어가있는 트리거들)

	//기본적으로 cp마다 실행해야 하는 거
	foreach (cp : EUDLoopPlayer(None,Force1)) {
		MouseSystem.checkScreenMouse();//마우스 좌표 가져오기
		setcurpl(cp);
        if (PI.bgmStatement[cp]) {//bgm 실행
            BGM.Play();
        }
    }
	
	//게임 진행
	switch (GI.game_step) {
		//기본 초기화 진행
		case 0:
			BasicSetting.Loop();
			break;
		//오프닝 연출
		case 1:
			OpeningDirecting.Loop();
			break;
		case 2:
			GameModeSelect.Loop();
			break;
		case 3:
			GameDifficultySelect.Loop();
			break;
		case 4:
			MainGame.Loop();
			break;
		default:
			break;
	}
	UnitSkillSystem.runExecutors();
	//C.	게임 모드 선택
	//D.	게임 난이도 선택
	//E.	캐릭터 선택
	//F.	게임 시작
	//
}

function afterTriggerExec() {//클래식 트리거 이후 작동
    SetDeaths(-111923, SetTo, 0, 0);//시야 밝히기?
    dwwrite(0x6509A0, 0); // EUD Turbo
    GI.GameTimerUpdate();
}